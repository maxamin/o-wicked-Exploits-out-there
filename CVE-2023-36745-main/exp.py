from pypsrp.powershell import PowerShell, RunspacePool
from pypsrp.wsman import WSMan



wsman = WSMan(server='exchange.webdxg.com', username='webdxg.com\\dddai', password='4IDF7LAU', path='powershell', ssl=False, port=80, auth='kerberos', scheme='http',)
with RunspacePool(wsman, configuration_name='Microsoft.Exchange') as pool:
    ps = PowerShell(pool)
    ps.add_cmdlet('Get-Mailbox').add_argument('-Anr')
    ps.invoke()
    errors = '\n'.join([str(s) for s in ps.streams.error])
    print(errors)
