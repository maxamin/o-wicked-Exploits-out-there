#include <locale.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <stdint.h>

// Edit to change the test string
#define TEST_STRING "hello! -gr25faaaaaaaaaaaaa"

// Edit to change the output buffer's length
#define DECODED_LENGTH 20

int ossl_punycode_decode(const char *pEncoded, const size_t enc_len, unsigned int *pDecoded, unsigned int *pout_length);

int main(int argc, char *argv[])
{
  setlocale(LC_CTYPE, "");

  uint32_t *decoded = (uint32_t*) malloc(DECODED_LENGTH * 4);
  unsigned int decoded_len = DECODED_LENGTH;

  if(!ossl_punycode_decode(TEST_STRING, strlen(TEST_STRING), decoded, &decoded_len)) {
    printf("Encoding failed!\n");
    free(decoded);
    exit(1);
  }

  printf("encoded: [%ld] %s\n", strlen(TEST_STRING), TEST_STRING);
  printf("decoded: [%d] ", decoded_len);

  int i;
  for(i = 0; i < decoded_len; i++) {
    printf("%lc", decoded[i]);
  }
  printf("\n");

  free(decoded);
  return 0;
}
