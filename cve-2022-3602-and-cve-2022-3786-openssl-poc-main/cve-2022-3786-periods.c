#include <locale.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <stdint.h>

int ossl_a2ulabel(const char *in, char *out, size_t *outlen);

int main(int argc, char *argv[])
{
  setlocale(LC_CTYPE, "");

  char *teststring = "a.b.c.d.e.f.g.h.i.j.k.l.m.n.o.p.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--.xn--";
  char out[16];
  size_t outlen = sizeof(out);

  int result = ossl_a2ulabel(teststring, out, &outlen);

  if(result == 1) {
    printf("Ok: [%ld] %s\n", outlen, out);
  } else if(result == 0) {
    printf("Too short: [%ld : %ld] %s\n", outlen, strlen(out), out);
  } else {
    printf("Bad string\n");
    exit(0);
  }

  return 0;
}

